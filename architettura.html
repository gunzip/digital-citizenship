

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modello di funzionamento &mdash; Cittadinanza digitale  documentazione</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Indice"
              href="genindex.html"/>
        <link rel="search" title="Cerca" href="search.html"/>
    <link rel="top" title="Cittadinanza digitale  documentazione" href="index.html"/>
        <link rel="next" title="Utilizzo delle API" href="api.html"/>
        <link rel="prev" title="Benefici del sistema di avvisi e preferenze" href="benefici.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Cittadinanza digitale
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduzione.html">Cittadinanza digitale</a></li>
<li class="toctree-l1"><a class="reference internal" href="benefici.html">Benefici del sistema di avvisi e preferenze</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Modello di funzionamento</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#invio-di-una-notifica-per-un-messaggio">Invio di una notifica per un messaggio</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#autenticazione-e-autorizzazioni">Autenticazione e autorizzazioni</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Utilizzo delle API</a></li>
<li class="toctree-l1"><a class="reference internal" href="risorse.html">Risorse</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Cittadinanza digitale</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Modello di funzionamento</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/architettura.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modello-di-funzionamento">
<h1>Modello di funzionamento<a class="headerlink" href="#modello-di-funzionamento" title="Link a questa intestazione">¶</a></h1>
<img alt="" src="https://raw.githubusercontent.com/teamdigitale/digital-citizenship-functions/master/docs/digital-citizenship-api.png" />
<ol class="arabic simple">
<li>Il client API invia una richiesta (HTTPS) all’endpoint del servizio</li>
<li>L’endpoint inoltra la richiesta al gestore delle API (<em>API gateway</em>)</li>
<li>L’API gateway valida le credenziali (API-Key) fornite dal client ed effettua un <em>look up</em> dell’utenza associata alle credenziali</li>
<li>L’API gateway inoltra la richiesta e gli attributi associati all’utenza al backend che realizza la logica applicativa (<em>API Function</em>)</li>
<li>Il backend controlla che l’utenza abbia i necessari permessi per eseguire l’operazione (API) richiesta e la processa; la maggior parte delle richieste <a class="reference external" href="https://it.wikipedia.org/wiki/Tavola_CRUD">CRUD</a> interagisce con il database documentale (<em>DB</em>).</li>
<li>Se la richiesta riguarda la creazione di un nuovo messaggio <a class="footnote-reference" href="#id3" id="id1">[1]</a> questo viene salvato sul database e inoltrato a una coda (<em>New Messages</em>) di processamento</li>
<li>Per ogni messaggio che giunge in coda, viene attivata una funzione che crea una <em>notifica</em> <a class="footnote-reference" href="#id4" id="id2">[2]</a> associata al messaggio e la inoltra ad una ulteriore coda (<em>New Notifications</em>)</li>
<li>Per ogni notifica la funzione ricava le informazioni sui recapiti digitali del destinatario, identificato da un codice fiscale,  tramite profilo salvato sul database. Se l’utente ha abilitato la memorizzazione dei messaggi (<em>Inbox</em>) il contenuto del messaggio viene salvato in un file (<em>blob storage</em>) e potrà esser recuperato in qualsiasi momento.</li>
<li>Se il destinatario ha configurato nel proprio profilo uno o più recapiti digitali (es. indirizzo email, numero di telefono, dispositivo mobile),   la notifica viene inoltrata su una ulteriora coda (una per canale)</li>
<li>Per ogni notifica che giunge nella coda specifica per un certo canale viene attivata una funzione che la processa</li>
<li>La funzione interagisce con un endpoint specifico per quel canale di inoltro (es. un MTA, un API di terze parti, etc.) che invierà il contenuto al destinatario</li>
<li>Il risultato della chiamata è memorizzato nel database (<em>Notification</em>) e potrà essere recuperato tramite l’API per interrogare lo stato della notifica inoltrata</li>
</ol>
<div class="section" id="invio-di-una-notifica-per-un-messaggio">
<h2>Invio di una notifica per un messaggio<a class="headerlink" href="#invio-di-una-notifica-per-un-messaggio" title="Link a questa intestazione">¶</a></h2>
<img alt="" src="_images/send-message-seq.svg" /><div class="section" id="autenticazione-e-autorizzazioni">
<h3>Autenticazione e autorizzazioni<a class="headerlink" href="#autenticazione-e-autorizzazioni" title="Link a questa intestazione">¶</a></h3>
<p>L’autenticazione al servizio è gestita tramite un token (API-Key) fornito all’utente che si registra
al <em>developer portal</em> (portale delle adesioni).</p>
<p>Il token deve essere trasmesso dai client <a class="reference external" href="https://it.wikipedia.org/wiki/Representational_State_Transfer">REST</a>
tramite un header HTTP custom (<em>Ocp-Apim-Subscription-Key</em>).</p>
<p>Ad esempio, tramite <a class="reference external" href="https://curl.haxx.se/">cURL</a>:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">GET</span> \
  <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">agid</span><span class="o">-</span><span class="n">apim</span><span class="o">-</span><span class="n">prod</span><span class="o">.</span><span class="n">azure</span><span class="o">-</span><span class="n">api</span><span class="o">.</span><span class="n">net</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">info</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;accept: application/json&#39;</span>
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;content-type: application/json&#39;</span> \
  <span class="o">-</span><span class="n">H</span> <span class="s1">&#39;Ocp-Apim-Subscription-Key: a1b2c3d4e5f6g7h8i9l0&#39;</span>
</pre></div>
</div>
<p>I diritti di accesso alle operazioni (singole API) sono basati sull’appartenenza dell’utente
(associato all’API-Key) a specifici sottoinsiemi di «gruppi» creati all’interno del servizio di API management;
ad esempio gli utenti appartenenti al gruppo <cite>ProfileRead</cite> hanno accesso in lettura alle informazioni
memorizzate nei profili degli utenti.</p>
<p>In genere per ogni risorsa esiste almeno un gruppo che ne permette la lettura ed eventualmente
uno che ne permette la scrittura (es. <cite>ProfileRead</cite>, <cite>ProfileWrite</cite>).</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Per <em>messaggio</em> si intende un contenuto testuale (titolo, corpo) associato a metadati che vengono salvati sul database.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Per <em>notifica</em> si intende un messaggio inoltrato su uno dei canali associati al destinatario (es. email, push notification).</td></tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="Utilizzo delle API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="benefici.html" class="btn btn-neutral" title="Benefici del sistema di avvisi e preferenze" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright CC-BY 4.0 - Agenzia per l&#39;Italia Digitale.
      Ultimo aggiornamento 17/11/2017.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>